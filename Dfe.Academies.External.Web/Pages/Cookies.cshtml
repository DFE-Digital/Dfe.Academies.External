@page
@using Microsoft.AspNetCore.Http.Features
@using Microsoft.AspNetCore.Http
@model Dfe.Academies.External.Web.Pages.CookiesModel
@{
	ViewData["Title"] = "Cookies";

    var consentFeature = this.HttpContext.Features.Get<ITrackingConsentFeature>();
    var canTrack = consentFeature?.CanTrack ?? false;
}

@{
    var cookieSaved = (bool)(TempData["cookiePreferenceSaved"] ?? false);
}

@if (cookieSaved)
{
    <govuk-notification-banner type="NotificationBannerType.Success">
        <p class="govuk-notification-banner__heading">
            You’ve set your cookie preferences. <a class="govuk-notification-banner__link" href="@TempData["returnPath"]">Go back to the page you were looking at.</a>
        </p>
    </govuk-notification-banner>
}

<div class="govuk-grid-column-two-thirds">
    <h1 class="govuk-heading-xl">Cookies</h1>
    <p  class="govuk-body">Cookies are small files saved on your phone, tablet or computer when you visit a website.</p>
    <p  class="govuk-body">We use cookies to make this service work and collect information about how you use our service.</p>

    <h2 class="govuk-heading-m">Essential cookies</h2>
    <p  class="govuk-body">Essential cookies keep your information secure while you use Apply to become an academy. We do not need to ask permission to use them.</p>
    <table class="govuk-table">
        <caption class="govuk-table__caption govuk-table__caption--m">Month you apply</caption>
        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">Name</th>
                <th scope="col" class="govuk-table__header">Purpose</th>
                <th scope="col" class="govuk-table__header">Expires</th>
            </tr>
        </thead>
        <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">.AspNetCore.Antiforgery</td>
                <td class="govuk-table__cell">Cross-Site Request Forgery prevention. This cookie ensures that your activity originated from this site.</td>
                <td class="govuk-table__cell">When you close your browser</td>
            </tr>
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">.AspNetCore.Session</td>
                <td class="govuk-table__cell">Stores any relevant data for your session</td>
                <td class="govuk-table__cell">When you close your browser</td>
            </tr>
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">.AspNet.Consent</td>
                <td class="govuk-table__cell">Cookie consent preference</td>
                <td class="govuk-table__cell">1 year</td>
            </tr>
        </tbody>
    </table>

    <h2 class="govuk-heading-m">Analytics cookies (optional)</h2>

	<h3 class="govuk-heading-s">Google Analytics</h3>
    <p  class="govuk-body">With your permission, we use Google Analytics to collect data about how you use Apply to become an academy. This information helps us improve our service.</p>
    <p  class="govuk-body">Google is not allowed to share our analytics data with anyone.</p>
    <p  class="govuk-body">Google Analytics stores anonymised information about:</p>
    <ul class="govuk-list govuk-list--bullet">
        <li>how you got to Apply to become and academy</li>
        <li>the pages you visit on Apply to become an academy</li>
        <li>any errors you see while using Apply to become an academy</li>
    </ul>
    <p  class="govuk-body">Google Analytics sets the following cookies:</p>
    <table class="govuk-table">
        <caption class="govuk-table__caption govuk-table__caption--m">Month you apply</caption>
        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th scope="col" class="govuk-table__header">Name</th>
                <th scope="col" class="govuk-table__header">Purpose</th>
                <th scope="col" class="govuk-table__header">Expires</th>
            </tr>
        </thead>
        <tbody class="govuk-table__body">
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">_gat</td>
                <td class="govuk-table__cell">Used to throttle request rate.</td>
                <td class="govuk-table__cell">1 minute</td>
            </tr>
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">_gid</td>
                <td class="govuk-table__cell">Used to distinguish users</td>
                <td class="govuk-table__cell">24 hours</td>
            </tr>
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">_ga</td>
                <td class="govuk-table__cell">Used to distinguish users</td>
                <td class="govuk-table__cell">2 years</td>
            </tr>
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">CookieKeepAlive</td>
                <td class="govuk-table__cell">Used to check how long a user's session has been idle for</td>
                <td class="govuk-table__cell">When you close your browser</td>
            </tr>
        </tbody>
    </table>

	<h3 class="govuk-heading-s">Azure Application Insights</h3>
	<p class="govuk-body">We use Azure Application Insights software to collect information about how you use this website. We do this to help make sure the site is meeting the needs of its users and to help us make improvements.</p>
	<p class="govuk-body">Azure Application Insights stores information about:</p>
	<ul class="govuk-list govuk-list--bullet">
		<li>the pages you visit on this website</li>
		<li>how long you spend on each page</li>
		<li>how you got to the site</li>
		<li>what you click on while you're visiting the site</li>
	</ul>
	<p class="govuk-body">We don't allow Microsoft to use or share our analytics data.</p>
	<p class="govuk-body">Azure Application Insights sets the following cookies:</p>
	<table class="govuk-table">
		<thead class="govuk-table__head">
			<tr class="govuk-table__row">
				<th scope="col" class="govuk-table__header">Name</th>
				<th scope="col" class="govuk-table__header">Purpose</th>
				<th scope="col" class="govuk-table__header">Expires</th>
			</tr>
		</thead>
		<tbody class="govuk-table__body">
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">ai_session</td>
				<td class="govuk-table__cell">This helps us track activity happening over a single browser session</td>
				<td class="govuk-table__cell">1 hour</td>
			</tr>
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">ai_user</td>
				<td class="govuk-table__cell">This helps us to identify the number of distinct users accessing the site over time by tracking if you've visited before</td>
				<td class="govuk-table__cell">1 year</td>
			</tr>
			<tr class="govuk-table__row">
				<td class="govuk-table__cell">ai_authuser</td>
				<td class="govuk-table__cell">This helps us to authenticated users and how they interact with the site</td>
				<td class="govuk-table__cell">When you close your browser</td>
			</tr>
		</tbody>
	</table>

    <h2 class="govuk-heading-m">Cookie settings</h2>
    <p  class="govuk-body">You can choose which cookies you’re happy for us to use.</p>
    <form method="post" name="frmCookies" novalidate="">
        <input type="hidden" name="returnUrl" value="@(TempData["returnUrl"] ?? this.HttpContext.Request.Headers["Referer"])" />
        <div class="govuk-form-group">
            <input type="hidden" name="redirectPath" value="@this.HttpContext.Request.Path" />
            <fieldset class="govuk-fieldset">
                <legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
                    <h3 class="govuk-fieldset__heading">Do you want to accept Google Analytics cookies?</h3>
                </legend>
                <div class="govuk-radios">
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input" name="cookies" id="cookies-accept" type="radio" value="accept" @(canTrack ? "checked" : "")>
                        <label class="govuk-label govuk-radios__label" for="cookies-accept">
                            Yes
                        </label>
                    </div>
                    <div class="govuk-radios__item">
                        <input class="govuk-radios__input" name="cookies" id="cookies-reject" type="radio" value="reject" @(!canTrack ? "checked" : "")>
                        <label class="govuk-label govuk-radios__label" for="cookies-reject">
                            No
                        </label>
                    </div>
                </div>
            </fieldset>
        </div>
        <button type="submit" class="govuk-button" data-module="govuk-button">Save changes</button>
    </form>
</div>
