@page
@model ApplicationSelectTrustModel
@{
	ViewData["Title"] = "Apply to become an academy - Trust Details";
}

@section BeforeMain
{
	<a asp-page="../../ApplicationOverview" asp-route-appId="@Model.ApplicationId" class="govuk-back-link">Back</a>
}

<div class="ccms-loader govuk-!-display-none"></div>

<div class="govuk-grid-column-two-thirds">
	<div id="divApplyingToDo" class="govuk-form-group">
		<div class="@(!ViewData.ModelState.IsValid ? "govuk-visually-hidden" : "")">
			<partial name="_ValidationSummary" model="Model.ValidationErrorMessagesViewModel"/>
		</div>

		<form method="post" id="search-form" novalidate>
			@Html.AntiForgeryToken()
			<input type="hidden" id="applicationId" asp-for="ApplicationId"/>
			<input type="hidden" id="trustReference" asp-for="TrustReference"/>
			<div class="@(!ViewData.ModelState.IsValid ? "govuk-form-group--error" : "")">

				<h2 class="govuk-heading-m">Trust details</h2>
				<fieldset class="govuk-fieldset" data-required data-error="Search cannot be blank" aria-required="true">
					<div id="SearchQueryContainer" class="govuk-form-group">
						<legend class="govuk-fieldset__legend govuk-fieldset__legend--l">
							<h2 class="govuk-fieldset__heading govuk-heading-m">
								Which trust is the school joining?
							</h2>
						</legend>
						<label class="govuk-hint"
						       for="schoolSelect">
							Enter the name of the trust, its Companies House number, or its group Id
						</label>
						<span asp-validation-for="SearchQuery" class="govuk-error-message"></span>
						<input id='SearchQueryInput' asp-for="@Model.SearchQuery"
						       class="govuk-input govuk-input--width-20"
						       maxlength="100"
						       type="search" aria-valuetext=""
						       aria-describedby="search-hint search-error"/>
						<div id="autocomplete-container"></div>
					</div>

					<div class="govuk-form-group">
						<div id="trustSelectedDetails" class="hideElement"></div>
						<div id="confirm-trust-checkbox" class="govuk-checkboxes" data-module="govuk-checkboxes">
							<div id="ConfirmationErrorContainer" class="hideElement">
								<span asp-validation-for="CorrectTrustConfirmation" class="govuk-error-message"></span>
							</div>
							<div class="govuk-checkboxes__item">
								<input id='ConfirmSelection'
								       asp-for="@Model.CorrectTrustConfirmation"
								       class='hideElement govuk-checkboxes__input'>
								<label id='confirm-trust-label' for='ConfirmSelection'
								       class='hideElement govuk-label govuk-checkboxes__label'>
									This is the correct trust
								</label>
							</div>
						</div>
					</div>
				</fieldset>
			</div>
			<br/>
			<div class="js-show">
				<input type="submit" asp-page-handler="AddTrust" id="btnAdd" value="Save and continue"
				       class="govuk-button govuk-!-margin-top-2 govuk-!-margin-bottom-8"/>
			</div>
			<noscript>
				<input type="submit" asp-page-handler="Find" id="btnFind" value="Search"
				       class="govuk-button govuk-!-margin-top-2 govuk-!-margin-bottom-8"/>
			</noscript>
		</form>
	</div>
</div>

@section Scripts {
	<script src="/js/academies.trustsearch.js" asp-append-version="true" asp-add-nonce></script>
	@{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
	
	@* Add Event listeners as inline scripts do not comply with CSP *@
	<script asp-add-nonce>
		document.addEventListener('DOMContentLoaded', function () {
			document.getElementById('ConfirmSelection')
				.addEventListener('click', academies.clearTrustConfirmCheckboxValidation(this.checked));
			document.getElementById('btnAdd')
				.addEventListener('click', academies.trustSearchClientSideValidation());
		});
	</script>
}